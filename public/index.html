<!DOCTYPE html>
	<head>
		<meta http-equiv="content-type" content="text/html; charset=utf-8" />
		<title>gridTest2 : Built with Processing and Processing.js</title>
		<link rel="icon"  type="image/x-icon" href="data:image/x-icon;base64,AAABAAEAEBAQAAEABAAoAQAAFgAAACgAAAAQAAAAIAAAAAEABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADAQAAVzABAEAjBQAaDwYAWjUGAGE6CQBrQQ0ATS8PAFhAJwBUQC8AbFI6AHVXPACBZk4A4NrWAPb19QAAAAAAAMmZmZmZmgAJIwAAAAAAcMIjPjA+PjAKpxIuMDMzMAm0Ii4zMzMACaIiLt3dMAAJtyIuIzPQAAm0Un5yM+IzKLRkfncy4iIotRF+dyLkIiq0QX53F+EiGrQUTkd34iIatEVu7u5iIVrBVVRBRFRVbAtGZGZla2uwAMu7u7u8vADAAwAAgAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAIABAADAAwAA" />
		
		<meta name = "viewport" content = "user-scalable=yes, initial-scale=1.0, maximum-scale=2.0, width=device-width">
		<meta name="Generator" content="Processing" />
		<!-- - - - - - - - - - - - - - - - - - - - - 
		+
		+    Wondering how this works? 
		+
		+    Go to: http://processing.org/
		+    and: http://processingjs.org/
		+
		+ - - - - - - - - - - - - - - - - - - - - -->
		
		<script src="//use.typekit.net/hfs4hop.js"></script>
<script>try{Typekit.load();}catch(e){}</script>
		
		
		<style type="text/css">
	body {
	  background-color: #333; color: #bbb; line-height: normal;
	  font-family: "fira-sans", sans-serif;
	  font-size: 11px; font-weight: normal; text-decoration: none;
		  line-height: 1.5em;
	}
	a img { 
		border: 0px solid transparent;
	}
	a, a:link, a:visited, a:active, a:hover { 
		color: #cdcdcd; text-decoration: underline;
	}
	h1 {
	    font-family: Arial, Helvetica Neue, Verdana, Geneva, sans-serif;
		width: 100%; letter-spacing: 0.1em;
		margin-bottom: 1em; font-size: 1.65em;
	}
	canvas { 
	width: 2048px;
        height: 1024px;
        transform-origin: left top;
	}
	#content { 
		position: fixed;
        width: 100%;
        height: 100%;
        top: 0px;
        left: 0px;
	}
            
            div#realContainer {
position: fixed;
z-index: 5;
top: 0px;
left: 0px;
width: 100%;
height: 100%;
}
            
            ::-webkit-input-placeholder {
   color: white;
}

:-moz-placeholder { /* Firefox 18- */
   color: white;  
}

::-moz-placeholder {  /* Firefox 19+ */
   color: white;  
}

:-ms-input-placeholder {  
   color: white;  
}
            
            
            form#search {
    position: absolute;
    width: 100%;
    height: 61px;
    border-radius: 25px;
    top: 0px;
    left: 0px;
}

div#search {
position: absolute;
width: 50%;
height: 48px;
border-radius: 25px;
background-color: rgba(137,192,232,.62);
top: 25px;
left: 25%;
}
        
           #search input[type="text"] {
width: 70%;
background-color: rgba(0,0,0,0);
border: none;
margin-left: 30px;
height: 26px;
font-size: 18px;
font-family: "fira-sans";
font-weight: 200;
margin-top: 11px;
color: white;
}

#search img {
float: right;
height: 50%;
margin-right: 30px;
margin-top: 9px;
    transition: transform .5s;
}

#search img:hover {
 transform-origin: center;
 -webkit-transform-origin: center;
    transform: scale(1.05);
    cursor: pointer;
}
    
    .toggler {
position: absolute;
top: 10px;
height: 50%;
width: 35px;
left: 102.5%;
transform: rotate(180deg);
-webkit-transform: rotate(180deg);
transform-origin: center center;
-webkit-transform-origin: center center;
}

.toggler img {
    margin: 0!important;
    height: 100%!important;
}
          div#list {
background-color: rgba(137,192,232,.62);
position: absolute;
top: 106%;
left: 25px;
width: 89%;
width: calc(100% - 55px);
height: 0px;
overflow: scroll;
transition: all .5s;
border-bottom-left-radius: 18px;
border-bottom-right-radius: 18px;
}

ul {
    list-style: none;
    
}

li {
margin-top: 24px;
margin-bottom: 15px;
color: white;
font-family: "fira-sans";
font-weight: 100;
font-size: 13px;
}
            
            
            @media (max-width: 900px) {
                #search {
                 width: 75%!important;
                    left: 11%!important;
                    top: 5px!important;
                }
                form#search {
                         width: 100%!important;
                    left: 0%!important;
                    top: 0px!important;
                        }
                
                #search input[type="text"] {
                     margin-left: 20px!important; 
                    }
                
                #search img {
float: right;
height: 44%;
margin-right: 25px;
margin-top: 12px;
}
                
            }
                @media (max-width: 600px) {
                #search {
                 width: 83%!important;
                    left: 3%!important;   
                }
                    
                      form#search {
                         width: 100%!important;
                    left: 0%!important;
                        }
                
                    #search input[type="text"] {
                     font-size: 14px;   
                    }
                    
                    li {
                     font-size: 12px;   
                    
                    }
                        
            }
            
            
            .help {
    position: absolute;
    right: 15px;
    bottom: 15px;
}

p {
    font-size: 21px;
    color: white;
    font-family: "fira-sans";
    margin-bottom: 0px;
    padding-left: 15px;
    padding-right: 15px;
}
            
            
            
            .tutorial {
    position: absolute;
    top: 0px;
    left: 0px;
    width: 100%;
    height: 100%;
    background-color: rgba(0,0,0,0.4);
    display: none;
}

.horizontalTutorial {
    background-color: rgba(137,192,232,.62);
    position: absolute;
    height: 19px;
    padding-top: 5px;
    padding-left: 15px;
    padding-right: 15px;
    color: white;
    font-family: "fira-sans";
    font-weight: 200;
    font-size: 14px;
}

div#toggleHelp {
    top: 34px;
    left: 79.5%;
    border-radius: 0px 10px 10px 0px;
    padding-left: 27px;
}

div#addHelp {
    top: 36.5px;
    right: 31%;
    padding-right: 34px;
    border-radius: 10px 0px 0px 10px;
}

div#visibilityHelp {
top: 96px;
left: 9.25%;
right: calc(68.25% + 25px);
padding-right: 16px;
border-radius: 10px 0px 0px 10px;
}

div#exitHelp {}

div#exitHelp {
    bottom: 13px; right: 52px; border-radius: 10px 0px 0px 10px; padding-right: 26px;
}

div#removeHelp {}

div#removeHelp {
top: 142px;
left: 19.25%;
padding-right: 19px;
border-radius: 10px 0px 0px 10px;
}     
          
    li img {
height: 15px!important;
margin-top: 0px!important;
position: absolute;
transform-origin: center;
-webkit-transform-origin: center;
transform: rotate(45deg)!important;
-webkit-transform: rotate(45deg)!important;
}

span.listItem {
    margin-left: 35px;
}

.visibleSwitch {
background-color: black;
width: 16px;
height: 16px;
float: left;
margin-left: 0px;
border-radius: 16px;
margin-right: 20px;
    transition: all .4s;
}
            
           div#progressBar {
    height: 100%;
    background-color: rgba(0,0,0,.25);
    width: 0%;
    
    z-index: -7;
    border-radius: 25px;
} 
            
            
            
            
            .error {
    position: absolute;
    width: 50%;
    height: 25%;
    background-color: rgba(0,0,0,.4);
    top: 30%;
    left: 25%;
    border-radius: 25px;
               
}

.error img {
    width: 20px;
    height: 20px;
    transform-origin: center;
    -webkit-transform-origin: center;
    transform: rotate(45deg);
    -webkit-transform: rotate(45deg);
    position: absolute;
    right: 22px;
    top: 15px;
}

.error .content {
    position: absolute;
    width: 69%;
    height: 53%;
    top: 30%;
    left: 10%;
    font-family: "fira-sans";
    font-size: 17px;
    line-height: 24px;
}
            
            
        @media (max-width: 900px) {     
            
            div#toggleHelp {
    border-radius: 0px 0px 10px 10px;
    width: 50px;
    height: 37px;
    top: 46px;
    right: 4%;
    left: initial;
}

div#addHelp {
    top: 17px;
    right: 23%;
}

div#removeHelp {
top: 126px;
left: 27%;
right: initial;
border-radius: 0px 10px 10px 0px;
}
            
  div#visibilityHelp {
top: 75px;
left: 22%;
right: initial;
border-radius: 0px 10px 10px 0px;
}
            
        }
            
         @media (max-width: 600px) {    
            
            
            div#addHelp {
    right: 28%;
}

div#toggleHelp {
    right: 0%;
}

div#visibilityHelp {
left: 24%;
}

div#removeHelp {
left: 32%;
}
         }
            
            
            
            
            .server {
position: absolute;
top: 69px;
left: 0px;
width: 100px;
height: 27px;
text-align: center;
overflow: hidden;
                opacity: .4;
    transition: top .7s, height .7s, opacity .7s;
                
}
            
            .time.back {
position: absolute;
bottom: -70px;
left: 0px;
padding: 4px;
border-radius: 9px;
                  transition: bottom .7s;
}
            
            .ip {
position: absolute;
bottom: 0px;
padding-top: 5px;
width: 100%;
padding-bottom: 5px;
border-radius: 9px;
                  transition: bottom .7s;
}
            
            
            .place {
position: absolute;
bottom: -40px;
border-radius: 10px;
padding: 1px;
font-size: 10px;

              transition: bottom .7s;
            }
            
            
            
          .right {
           right: 0px;   
              left: initial!important;
          }
            
            
             .server:hover {
position: absolute;
top: 0px;
left: 0px;
width: 100px;
height: 100px;
                 opacity: 1;
 z-index: 25;   
                text-align: center;
}
            

            .hideIt {
                
             display: none;   
            }
            
            
           .server:hover .time.back {
    position: absolute;
    bottom: 0px;
    left: 0px;
    padding: 4px;
    border-radius: 9px;
}

.server:hover .place {
    position: absolute;
    bottom: 30px;
    border-radius: 10px;
    padding: 1px;
    font-size: 10px;
}

.server:hover .ip {
    position: absolute;
    bottom: 70px;
    padding-top: 5px;
    width: 100%;
    padding-bottom: 5px;
    border-radius: 9px;
}  
            
            
            img.pointer {
float: right;
height: 10px;
margin-top: 2px;
margin-left: 5px;
margin-right: 5px;
transform-origin: center center;
}
            
		</style>
		<!--[if lt IE 9]>
			<script type="text/javascript">alert("Your browser does not support the canvas tag.");</script>
		<![endif]-->
		<script src="http://cdn.jsdelivr.net/jquery/2.1.1/jquery.min.js"></script>
		<script src="/processing.js" type="text/javascript"></script>
		<script type="text/javascript">
// convenience function to get the id attribute of generated sketch html element
function getProcessingSketchId () { return 'gridTest2'; }
</script>

	</head>
	<body>
	
		
				
		<div id="content">
			
				<canvas id="processingSketch" data-processing-sources="/gridTest2.pde" 
						width="2048" height="1024">
					<p>Your browser does not support the canvas tag.</p>
					<!-- Note: you can put any alternative content here. -->
				</canvas>
				<noscript>
					<p>JavaScript is required to view the contents of this page.</p>
				</noscript>
	    	    
	    	    <canvas id="dataPoints" width="100%" height="100%"></canvas>
	    	
	    	<div id="realContainer">
	    	    <div class="error">
	    	        <img src="add.svg"></img>
	    	        <div class="content"></div>
	    	        
	    	    </div>
	    	    <div id="search">
    	        <div id="progressBar"></div>
	    	        <form action="none" id="search">
	    	            <input type="text" placeholder="Enter website url to see its route..."></input>
	    	            <img src="search.svg" alt="Search">
	    	        </form>
	    	        <div class="toggler"><img src="triangle.svg" alt="Expand List"></div>
	    	        
	    	        <div id="list">
	    	            <ul>
	    	               
	    	            </ul>
	    	            
	    	            
	    	        </div>
	    	    </div>
	    	    
	    	    <div class="help">
	    	        <p>?</p>   	        
	    	        
	    	    </div>
	    	    
	    	    <div class="tutorial">
    	        
	    	        <div class="horizontalTutorial" id="toggleHelp">Toggle the list</div>
	    	        <div class="horizontalTutorial" id="addHelp">Add a site to the list</div>
	    	        <div class="horizontalTutorial" id="removeHelp">Remove the site</div>
	    	        <div class="horizontalTutorial" id="visibilityHelp">Toggle the visibility</div>
	    	        <div class="horizontalTutorial" id="exitHelp">Click anywhere to go to the map</div>
	    	        <div class="horizontalTutorial" id="moreHelp">Display more information</div>
	    	        
	    	        
	    	    </div>
	    	    
	    	</div>
	    	
		</div>
		
		<script>
            
            var scaleX = window.innerWidth*1.4/2048;
            var scaleY = window.innerHeight*1.4/1024;
            
            var whichScale;
            if (window.innerWidth> window.innerHeight *2) {
                whichScale = scaleX;
                
            } else {
             whichScale = scaleY;   
            }
            
            whichScale = lerp(whichScale,1,.2);
            
            
            var canvas, context;
            var server;
            
            
            var drag, search, tut;
             var pro;
            $(window).load(function() {
                
                
                
            canvas = document.getElementById("dataPoints");
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            context = canvas.getContext('2d');
            
                
                
            $("#processingSketch").css("transform","scale(" + whichScale + "," + whichScale + ") translateX(-" + (((2048*whichScale) - window.innerWidth)/2) + "px)");
            $("#processingSketch").css("-webkit-transform","scale(" + whichScale + "," + whichScale + ") translateX(-" + (((2048*whichScale) - window.innerWidth)/2) + "px)");
                
                drag = new setUpDragging(((2048 - window.innerWidth)/2), whichScale);
                search = new searchMenu();
                
                $(window).resize(function() {
                   resize();
                   $('#content').hide().show(0);
                });
                
                 requestAnimationFrame(search.loader);
                
                
                $(".error").hide();
                $(".error img").click(function() {
                    $(".error .content").html("");
                   $(".error").hide(); 
                    
                });
                
                tut = new tutorial();
                
                server = new ServerPoints();
                
               getSketch();
                
            });
            //var proc = Processing.getElementById('processingSketch');
        
            
            function animate() {
                server.animation();
                        
                
                requestAnimationFrame(animate);
                
            }
            
            function ServerPoints() {
                
                this.hasProcessing = false;
                
                
                this.sites = [];
                
                this.points = [];
                
                this.getSites = function() {
                    
                 this.hasProcessing = true;   
                    console.log(pro);
                    console.log(this);
                    setTimeout(function() {
                    server.sites = pro.getSites().sites;
                    animate();
                    }, 800);
                }
                
                
                
                this.animation = function() {
                    this.letsDoSomePositioning();
                    
                    var oldSize = this.sites.size();
                  //  this.sites = pro.getSites().sites;
                    //console.log(this.sites);
//                    console.log(this.sites.size() + " -----");
//                    console.log(oldSize);
                    
                   var sketch = [];
                    sketch.x = $("#processingSketch").offset().left - 50;
                    sketch.y = $("#processingSketch").offset().top - 105;
                    sketch.h = $("#processingSketch").height() * drag.scale;
                    sketch.w = $("#processingSketch").width() * drag.scale;
                        for (var i = 0; i<this.sites.size(); i++) {
                           // console.log(this.sites.get(i));
                             var timeAdd = 0;    
                            var lastActive;
                            for (var p = 0; p<this.sites.get(i).dataPoints.size(); p++) {
                                      var serv = this.sites.get(i).dataPoints.get(p);
                                     
                                      if (this.sites.get(i).dataPoints.get(p).ele==undefined || this.sites.get(i).dataPoints.get(p).ele==null ) {
                                      this.sites.get(i).dataPoints.get(p).ele = document.createElement("div");
                                          var ele = this.sites.get(i).dataPoints.get(p).ele;
                                       ele.className = "server";
                                          ele.setAttribute("color", search.routes[i].color);
                                          ele.setAttribute("name", this.sites.get(i).name);
                                          
                                         
                                            console.log(this.sites.get(i).dataPoints.get(p).time);
                                              if (this.sites.get(i).dataPoints.get(p).lat == "0") {
                                           ele.className += " hideIt";
                                                  console.log("timeAdd:  " + timeAdd);
                                               timeAdd+=parseFloat(this.sites.get(i).dataPoints.get(p).time);
                                          } else {
                                           
                                              var colour = ele.getAttribute("color");
                                              var left = false;
                                              if (lastActive!=null || lastActive!=undefined) {
                                                  if (lastActive.realPos.x<=this.sites.get(i).dataPoints.get(p).realPos.x) {
                                                   left=true;   
                                                  }
                                                  
                                              }
                                              
                                              var backTime = document.createElement("div");
                                              backTime.className = "time back";
                                              if (left) {
                                               backTime.className+=" left";   
                                              } else {
                                               backTime.className+=" right";   
                                              }
                                              
                                              backTime.innerHTML = parseFloat(this.sites.get(i).dataPoints.get(p).time + timeAdd).toFixed(2) + "ms";
                                              backTime.style.backgroundColor = colour;
                                              
                                              var pointer = document.createElement('img');
                                              pointer.className="pointer";
                                              pointer.src="/pointer.svg";
                                              backTime.appendChild(pointer);
                                              ele.appendChild(backTime);
                                              
                                              var ipAdd = document.createElement('div');
                                              ipAdd.className = "ip";
                                              ipAdd.innerHTML = this.sites.get(i).dataPoints.get(p).ip;
                                               ipAdd.style.backgroundColor = colour;
                                              ele.appendChild(ipAdd);
                                              
                                              var cou = document.createElement('div');
                                              cou.className = "place";
                                              cou.innerHTML = this.sites.get(i).dataPoints.get(p).city + ", " + this.sites.get(i).dataPoints.get(p).state;
                                               cou.style.backgroundColor = colour;
                                              ele.appendChild(cou);
                                              
                                              console.log("both:  " + this.sites.get(i).dataPoints.get(p).time + timeAdd);
                                              timeAdd = 0;
                                              
                                              
                                              lastActive = this.sites.get(i).dataPoints.get(p);
                                              
                                          }
                                          
                                          document.body.appendChild(ele);
                                          
                                       
                                          
                                          
                                      } else {
                                          
                                          var xx = ((serv.realPos.x/2048) * sketch.w) + sketch.x;
                                          var yy = ((serv.realPos.y/1024) * sketch.h) + sketch.y;
                                          
                                          if (serv.realPos.x!=0 && serv.realPos.y!=0) {
                                            serv.ele.style.transform = "translate3d(" + xx + "px, " + yy + "px,0)";   
                                            serv.ele.style.webkitTransform = "translate3d(" + xx + "px, " + yy + "px,0)";   
                                              
                                              
                                          }
                                      }
                                      
                                  }
                            
                            } //end first if this.sitesLoop
                    
                    
                    
                         
                    
                         for (var i = 0; i<this.sites.size(); i++) {
                           // console.log(this.sites.get(i));
                             var timeAdd = 0;    
                            var lastActive=0;
                             var site = this.sites.get(i);
                            for (var p = 0; p<site.dataPoints.size(); p++) {
                                var dP = site.dataPoints.get(p);
                                if (dP.ele.className!="server hideIt") {
                                    
                                    if (lastActive!=0) {
                                        var xx = dP.realPos.x - lastActive.realPos.x;
                                        var yy = dP.realPos.y - lastActive.realPos.y;
                                       
                                        
                                        var rot = pro.degrees( pro.atan2(-1 * yy,-1 * xx)  ) + 360;
                                       
                                        dP.ele.getElementsByClassName("pointer")[0].style.transform = "rotate(" + rot + "deg)";
                                        dP.ele.getElementsByClassName("pointer")[0].style.webkitTransform = "rotate(" + rot + "deg)";
                                        
                                    }
                                    
                                    lastActive = dP;
                                }
                            }
                         }
                 
                    
                    
                   
                    
                    
                }
                
                
                
                   this.letsDoSomePositioning = function() {
               
                     for (var i = 0; i<this.sites.size(); i++) {
                           // console.log(this.sites.get(i));
                              
                            var lastActive;
                            for (var p = 0; p<this.sites.get(i).dataPoints.size(); p++) {
                                      var serv = this.sites.get(i).dataPoints.get(p);
                                     console.log("shit");
                                      if ((serv.merged==undefined || serv.merged==null) && (serv.ele!=null || serv.ele!=undefined)) {
                                          console.log("we got some");
                                          console.log(this.sites.get(i).dataPoints.get(p).realPos);
                                    for (var d = p+1; d<this.sites.get(i).dataPoints.size(); d++) {                                         if (this.sites.get(i).dataPoints.get(p).realPos.x==this.sites.get(i).dataPoints.get(d).realPos.x && this.sites.get(i).dataPoints.get(d).ele.className!="server hideIt" ) {
                                        console.log("oh yeaaahh");
                                        this.sites.get(i).dataPoints.get(d).merged = true;
                                        var newEle = this.sites.get(i).dataPoints.get(d).ele.childNodes[0];
                                                
                                        console.log(this.sites.get(i).dataPoints.get(d).ele);
                                      //this.sites.get(i).dataPoints.get(p).ele.appendChild(newEle);
                                        
                    this.sites.get(i).dataPoints.get(d).ele.parentNode.removeChild(this.sites.get(i).dataPoints.get(d).ele);
                                        
                                          //add .childNodes[0] to the p element and remove d element
                                    }
                                    }
                                this.sites.get(i).dataPoints.get(p).merged = true;
                                          
                             }// end checking if we have already merged the servers
                            }// end sites loop
                                
                            }//end second if this.sitesLoop 
                
                
            }
                
                
                
            }
            
            
            
         
            
            
            function getSketch() {
                
                pro = Processing.getInstanceById("processingSketch");
                if (!pro) {
                 console.log("shit");
                    setTimeout(function() {
                        getSketch();
                    },500);
                    
                } else {
                 server.getSites();   
                }
                
            };
            
            
            function resize() {
                 var scaleX = window.innerWidth/2048;
            var scaleY = window.innerHeight/1024;
            
            var whichScale;
            if (window.innerWidth> window.innerHeight *2) {
                whichScale = scaleX;
                
            } else {
             whichScale = scaleY;   
            }
            
            whichScale = lerp(whichScale,1,.2);
               drag.scale = whichScale; 
                drag.resize();
                drag.moveIt();
                
            }
            
            
            function setUpDragging(startingX, startingScale) {
                
                this.xPos = 0;
                this.yPos = 0;
                this.oldX = 0;
                this.oldY = 0;
                this.xOff = -1 * startingX;
                console.log(this.xOff);
                this.yOff = 0;
                
                this.scale = startingScale;
                
                this.size = {};
                this.size.w = 2048 * this.scale;
                this.size.h = 1024 * this.scale;
                
                
                this.bounds = {};
                this.bounds.left = window.innerWidth - this.size.w;
                this.bounds.top = window.innerHeight - this.size.h;
                this.bounds.bottom = 0;
                this.bounds.right = 0;
                
                
                
                this.resize = function() {
                   this.size.w = 2048 * this.scale;
                this.size.h = 1024 * this.scale; 
                    
                   this.bounds.left = window.innerWidth - this.size.w;
                this.bounds.top = window.innerHeight - this.size.h;
                this.bounds.bottom = 0;
                this.bounds.right = 0;
                 
                }
                
                
                this.clicked = false;
                
                var el = $("#realContainer")[0];
                
                
                this.start = function(e) {
                    // console.log(e);   
                    if (e.targetTouches) {
                     e = e.targetTouches[0];   
                    }
                    
                    drag.clicked = true;
                    drag.xPos = e.pageX;
                    drag.yPos = e.pageY;
                };
                
                this.move = function(e) {
                    
                    
                    var toContinue = false;
                    
                    if (e.toElement) {
                     if  (e.toElement.id=="realContainer") {
                      toContinue=true;   
                     }
                    } else {
                     if (e.srcElement.id=="realContainer") {
                         toContinue=true; 
                     }
                    }
                    
                   if (drag.clicked && toContinue) {
                       
                        if (e.targetTouches) {
                     e = e.targetTouches[0];   
                    }
                       
                    //console.log(e);   
                    drag.oldX = drag.xPos;
                    drag.oldY = drag.yPos;
                    drag.xPos = e.pageX;
                    drag.yPos = e.pageY;
                       
                       var moveItX = drag.xPos - drag.oldX;
                       var moveItY = drag.yPos - drag.oldY;
                       console.log(moveItX + " " + moveItY);
                       console.log(drag.xOff);
                       console.log(drag);
                       drag.xOff += moveItX;
                       drag.yOff+= moveItY;
                       
                      
                       
                       console.log(drag.xOff);
                       console.log("translate(" + drag.xOff + "px, " + drag.yOff + "px) scale(" + drag.scale + "," + drag.scale + ")");
                     //   $("#processingSketch").css("transform","scale(" + drag.scale + "," + drag.scale + ") translate(" + drag.xOff + "px, " + drag.yOff + "px)");
                    drag.moveIt();
                   }
                    
                };
                
                this.end = function(e) {
                    drag.clicked=false;
                    
                }
                
                
                this.moveIt = function() {
                        
                         if (this.xOff>0) {
                        this.xOff = 0;   
                       } else if(this.xOff<this.bounds.left){
                        this.xOff=this.bounds.left;   
                       }
                       
                       if (this.yOff>0) {
                        this.yOff = 0;   
                       } else if(this.yOff<this.bounds.top){
                        this.yOff=this.bounds.top;   
                       }
                    
                    
                      $("#processingSketch").css("transform","scale(" + this.scale + "," + this.scale + ") translate(" + this.xOff + "px, " + this.yOff + "px)");
                      $("#processingSketch").css("-webkit-transform","scale(" + this.scale + "," + this.scale + ") translate(" + this.xOff + "px, " + this.yOff + "px)");
                    
                }
                
                
                el.addEventListener("touchstart", this.start, false);
                
                el.addEventListener("touchmove", this.move, false);
                
                el.addEventListener("touchend", this.end, false);
                
                 el.addEventListener("mousedown", this.start, false);
                
                el.addEventListener("mousemove", this.move, false);
                
                el.addEventListener("mouseup", this.end, false);
                
                
            }
            
            
            
            
            function tutorial() {
                
             this.visible = false;
                
                $(".help").click(function() {
                   
                   
                        this.visisble = true;
                     $(".tutorial").css("display", "block");   
                  if (search.open==false) {
                      search.toggleIt()
                      
                  }
                    
                    
                });
                
                $(".tutorial").click(function() {
                       this.visisble = false;
                     $(".tutorial").removeAttr("style");
                    
                    if (search.open) {
                      search.toggleIt()
                      
                  }
                    
                });
                
                
                
            }
            
            
            function searchMenu() {
                
             this.toggler = $(".toggler");
             this.search = $("#search img");
             this.progressBar = $("#progressBar");
                
                this.progress = 0;
                this.loading = false;
                
                this.open = false;
                
                
                this.colors = [];
                
                this.colorCount = 0;
                
                this.colors[0] = "rgb(218,39,69)";
                this.colors[1] = "rgb(135,142,246)";
                this.colors[2] = "rgb(101,189,81)";
                this.colors[3] = "rgb(240,96,0)";
                this.colors[4] = "rgb(255,255,255)";
                
                this.routes = [];
                
                
               
                
                
                this.toggleIt = function() {
                   if (this.open==false) {
                     this.open = true;   
                        $("#list").height("150px");
                    } else {
                        this.open = false;
                        
                        $("#list").removeAttr("style");
                    }  
                    
                }
                
                
                 this.toggler.click(function() {
                   search.toggleIt();
                    
                });
                
             
                this.suspendSubmission = false;
                
                
                this.loader = function() {
                   
                 if (search.loading) {
                  search.progress+=.03;
                     search.progressBar.css("width",search.progress + "%");
                     
                 }
                    
                    requestAnimationFrame(search.loader);
                }
                
                
               
                this.colorCycle = function() {
                    this.colorCount++;
                    if (this.colorCount>4) {
                     this.colorCount = 0;   
                    }
                    
                    
                }
                
                
                
                this.addSite = function(input, num, routeArray) {
                    
                    
                     console.log("AddSite");
                    
                    console.log(routeArray);
                    console.log(routeArray.length);
                        
                    var whichSite = pro.addSite(input);
                    
                    for (var i = 0; i<Object.size(routeArray); i++) {
                     var stop = routeArray[i];   
                      console.log(stop); pro.addSomeData(stop.lat,stop.lon,stop.time,stop.country,stop.city,stop.state,stop.zip,stop.ip, whichSite); 
                        
                    }
                    this.colorCycle();
                    
                     this.routes[num] = [];
                     this.routes[num].route = routeArray;
                     this.routes[num].color = this.colors[this.colorCount];
                      this.routes[num].open = true
                     
                    
                    addLi(input, num);
                     
                    
                }
                
                
                this.deleteRoute = function(num) {
                 
                    var listItems = document.getElementById("list").childNodes[1].getElementsByTagName("li");
                    
                    var name;
                    
                    for (var i = 0; i<listItems.length; i++) {
                        
                     if (listItems[i].childNodes[0].getAttribute("num")==num) {
                         name = listItems[i].childNodes[2].innerHTML; 
                         
                         
                        
                         $(".server").each(function() {
                            if ($(this).attr("name")==name) {
                                $(this).remove();
                            }
                             
                         });
                         
                         
                         pro.removeSite(listItems[i].childNodes[2].innerHTML);
                         listItems[i].parentNode.removeChild(listItems[i]); 
                         
                         
                     }
                        
                    }
                    
                    
                    
                     
                    
                    
                    search.routes[num] = "dead";
                    
                    
                    
                    
                }
                
               
                this.toggleVisible = function(num, ele) {
                    
                   console.log(ele.parentNode.childNodes[2].innerHTML);
                    pro.letsHide(ele.parentNode.childNodes[2].innerHTML);
                if (search.routes[num].open) {
                    search.routes[num].open = false;
                    ele.style.height = "6px";
                    ele.style.marginTop = "5px";
                    ele.style.borderRadius = "0px";
                    
                    for (var i = 0; i< server.sites.size(); i++) {
                     
                        if (server.sites.get(i).name == ele.parentNode.childNodes[2].innerHTML) {
                         for (var p = 0; p<server.sites.get(i).dataPoints.size(); p++) {
                             server.sites.get(i).dataPoints.get(p).ele.style.display = "none";
                             
                         }
                            
                        }
                        
                        
                    }
                    
                    
                } else {
                   search.routes[num].open = true;
                    ele.style.height = ""; 
                    ele.style.marginTop = ""; 
                    ele.style.borderRadius = "";
                    
                       for (var i = 0; i< server.sites.size(); i++) {
                     
                        if (server.sites.get(i).name == ele.parentNode.childNodes[2].innerHTML) {
                         for (var p = 0; p<server.sites.get(i).dataPoints.size(); p++) {
                             server.sites.get(i).dataPoints.get(p).ele.style.display = "";
                             
                         }
                            
                        }
                        
                        
                    }
                    
                }   
                    
                }
                
                
                
                this.submission = function() {
                    if (this.suspendSubmission==false) {
                    var input = $("form#search  input").val();
                    console.log(input);
                    
                    if (input=="") {
                     return false;   
                    }
                        this.loading = true;
                    
                    this.suspendSubmission=true;
                    
                    
                        this.error = function() {
                            search.suspendSubmission=false;
                                search.loading = false;
                                search.progress=0;
                                 search.progressBar.removeAttr("style");
                                
                                $(".error .content").html("Sorry, we couldn't get the route to that site, try again. Or maybe try a different site.");
                                $(".error").show();
                            
                        }
                        
                    input = input.trim();
                        
                        $.ajax({
                            type: "GET",
                            url: "http://idtraceroute.herokuapp.com/route3/" + input + "/1300/33434",
                            success: function(e) {
                                console.log(e);
                                
                                if (e=="error" || e=="") {
                                    
                                    search.error();
                                    
                                    
                                } else {
                            
                                  var newArray = e.match(/\d+\:+\s+(\d+\.)+\d+\s+\d+\.+\d+\w+/g);
                                  
                                 //   console.log(newArray);
                                
                                    var routeArray = {};
                                    
                                    for (var i = 0; i<newArray.length; i++) {
                                        
                                        routeArray[i] = {};
                                        newArray[i] =newArray[i].replace(/\s+/g, ' ');
     
                                        newArray[i] =newArray[i].replace(/\:/g, '');
                                        var hopSplit = newArray[i].split(" ");
                                       // console.log(hopSplit);
                                        routeArray[i].number = hopSplit[0];
                                        routeArray[i].ip = hopSplit[1];
                                        routeArray[i].time = hopSplit[2].replace(/\m+s/g,"");
                                        
                                    }
                                   
                                  //  console.log(routeArray);
                                  //  console.log(JSON.stringify(routeArray));
                                    
                                      search.progressBar.css("transition","all .5s");
                                search.progressBar.css("width","50%");
//                                    search.routes[num] = [];
//                                    search.routes[num].route = routeArray;
//                                    search.routes[num].color = search.colors[search.colorCount];
//                                    search.colorCycle();
                                    
                                    
                                     $.ajax({
                            type: "POST",
                            url: "http://idtraceroute.herokuapp.com/toGeolocation",
                            contentType: "application/json;charset=UTF-8",
                            data: JSON.stringify(routeArray),
                            async: true,
                            success: function(e) {
                                 $("form#search  input").val("");
                                
                                  search.suspendSubmission=false;
                                search.loading = false;
                                search.progress=0;
                                 search.progressBar.css("transition","all .5s");
                                search.progressBar.css("width","100%");
                                
                                var routeArray = e;
                                
                                var num = -1;
                                
                                for (var p = 0; p<search.routes.length; p++) {
                                 if (search.routes[p]=="dead") {
                                     console.log(search.routes[p]);
                                  num=p;   
                                 }
                                    
                                }
                                
                                if (num==-1) {
                                num = search.routes.length;
                                }
                                    
                                console.log(JSON.stringify(routeArray));
                                
                                search.addSite(input, num, routeArray);
                                
                                  setTimeout(function() {
                                
                                    search.progressBar.removeAttr("style");
                                    
                                },1400);
                                
                            }, error: function(e) {
                                
                                console.log(e);  
                            search.error();
                                
                                
                            }});  //end of Post request
                                    
                                    
                               
                                //addLi(input, num);
                              
                    
                                
                              
                                    
                                }
                                
                            },
                            error: function(e) {
                             console.log(e);  
                            search.error();
                                
                                
                            },
                            timeout: 20000
                            }) 
                    
                    
                    
                }
                }
                
                $("form#search").submit(function(e) {
                    e.preventDefault();
                    console.log("haha");
                    search.submission();
                    
                    
                }); 
                
                this.search.click(function() {
                   $("form#search").submit(); 
                    
                });
                
                
            }
        
            
            
            
        function addLi(site, num) {
            
            var li = document.createElement('li');
            var img = document.createElement('img');
            img.src="add.svg";
            img.className = "deleteRoute";
            img.setAttribute("num", num);
            
            var swi = document.createElement('div');
            swi.className = "visibleSwitch";
            swi.style.backgroundColor = search.colors[search.colorCount];
            swi.setAttribute("num", num);
            
            var span = document.createElement('span');
            span.className = "listItem";
            span.innerHTML = site;
            
            li.appendChild(img);
            li.appendChild(swi);
            li.appendChild(span);
            
            var list = document.getElementById("list").childNodes[1];
            
            search.routes[num].ele = li;
            
            list.appendChild(li);
            
            
            
            img.addEventListener('click', function(e) {
               console.log(e);
                var num = e.toElement.getAttribute("num");
                
                search.deleteRoute(num);
                
                
            });
            
            swi.addEventListener('click', function(e) {
                console.log(e);
                var num = e.toElement.getAttribute("num");
                
                search.toggleVisible(num,e.toElement);
                
                
            });
            
            
            // <li><img src="add.svg"></img><div class="visibleSwitch"></div><span class="listItem">www.facebook.com</span></li>
            
            
        }
            
            
            
        function dist(x1, y1, x2, y2) {

            var dx = Math.abs(x1 - x2);
            var dy = Math.abs(y1 - y2);

            var d = Math.sqrt(Math.pow(dx, 2) + Math.pow(dy, 2));

            return d;

        }
      
       
        
        
         function radians(degrees) {
            return degrees * Math.PI / 180;
        };

        function degrees(radians) {
            return radians * 180 / Math.PI;
        };
    
        
        
        function lerp(a, b, t) {
            var x = a + t * (b - a);
            return x;
        }
            
            
            Object.size = function(obj) {
    var size = 0, key;
    for (key in obj) {
        if (obj.hasOwnProperty(key)) size++;
    }
    return size;
};
            
        </script>
		
		
	</body>
</html>
