<!DOCTYPE html>
	<head>
		<meta http-equiv="content-type" content="text/html; charset=utf-8" />
		<title>gridTest2 : Built with Processing and Processing.js</title>
		<link rel="icon"  type="image/x-icon" href="data:image/x-icon;base64,AAABAAEAEBAQAAEABAAoAQAAFgAAACgAAAAQAAAAIAAAAAEABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADAQAAVzABAEAjBQAaDwYAWjUGAGE6CQBrQQ0ATS8PAFhAJwBUQC8AbFI6AHVXPACBZk4A4NrWAPb19QAAAAAAAMmZmZmZmgAJIwAAAAAAcMIjPjA+PjAKpxIuMDMzMAm0Ii4zMzMACaIiLt3dMAAJtyIuIzPQAAm0Un5yM+IzKLRkfncy4iIotRF+dyLkIiq0QX53F+EiGrQUTkd34iIatEVu7u5iIVrBVVRBRFRVbAtGZGZla2uwAMu7u7u8vADAAwAAgAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAIABAADAAwAA" />
		
		<meta name = "viewport" content = "user-scalable=yes, initial-scale=1.0, maximum-scale=2.0, width=device-width">
		<meta name="Generator" content="Processing" />
		<!-- - - - - - - - - - - - - - - - - - - - - 
		+
		+    Wondering how this works? 
		+
		+    Go to: http://processing.org/
		+    and: http://processingjs.org/
		+
		+ - - - - - - - - - - - - - - - - - - - - -->
		
		<script src="//use.typekit.net/hfs4hop.js"></script>
<script>try{Typekit.load();}catch(e){}</script>
		
		
		<style type="text/css">
	body {
	  background-color: #333; color: #bbb; line-height: normal;
	  font-family: "fira-sans", sans-serif;
	  font-size: 11px; font-weight: normal; text-decoration: none;
		  line-height: 1.5em;
	}
	a img { 
		border: 0px solid transparent;
	}
	a, a:link, a:visited, a:active, a:hover { 
		color: #cdcdcd; text-decoration: underline;
	}
	h1 {
	    font-family: Arial, Helvetica Neue, Verdana, Geneva, sans-serif;
		width: 100%; letter-spacing: 0.1em;
		margin-bottom: 1em; font-size: 1.65em;
	}
	canvas { 
	width: 2048px;
        height: 1024px;
        transform-origin: left top;
	}
	#content { 
		position: fixed;
        width: 100%;
        height: 100%;
        top: 0px;
        left: 0px;
	}
            
            div#realContainer {
position: fixed;
z-index: 5;
top: 0px;
left: 0px;
width: 100%;
height: 100%;
}
            
            ::-webkit-input-placeholder {
   color: white;
}

:-moz-placeholder { /* Firefox 18- */
   color: white;  
}

::-moz-placeholder {  /* Firefox 19+ */
   color: white;  
}

:-ms-input-placeholder {  
   color: white;  
}
            
            
            form#search {
    position: absolute;
    width: 100%;
    height: 61px;
    border-radius: 25px;
    top: 0px;
    left: 0px;
}

div#search {
position: absolute;
width: 50%;
height: 48px;
border-radius: 25px;
background-color: rgba(137,192,232,.62);
top: 25px;
left: 25%;
}
        
           #search input[type="text"] {
width: 70%;
background-color: rgba(0,0,0,0);
border: none;
margin-left: 30px;
height: 26px;
font-size: 18px;
font-family: "fira-sans";
font-weight: 200;
margin-top: 11px;
color: white;
}

#search img {
float: right;
height: 50%;
margin-right: 30px;
margin-top: 9px;
    transition: transform .5s;
}

#search img:hover {
 transform-origin: center;
    transform: scale(1.05);
    cursor: pointer;
}
    
    .toggler {
position: absolute;
top: 10px;
height: 50%;
width: 35px;
left: 102.5%;
transform: rotate(180deg);
transform-origin: center center;
}

.toggler img {
    margin: 0!important;
    height: 100%!important;
}
          div#list {
background-color: rgba(137,192,232,.62);
position: absolute;
top: 106%;
left: 25px;
width: 89%;
width: calc(100% - 55px);
height: 0px;
overflow: scroll;
transition: all .5s;
border-bottom-left-radius: 18px;
border-bottom-right-radius: 18px;
}

ul {
    list-style: none;
    
}

li {
margin-top: 24px;
margin-bottom: 15px;
color: white;
font-family: "fira-sans";
font-weight: 100;
font-size: 13px;
}
            
            
            @media (max-width: 900px) {
                #search {
                 width: 75%!important;
                    left: 11%!important;
                    top: 5px!important;
                }
                form#search {
                         width: 100%!important;
                    left: 0%!important;
                    top: 0px!important;
                        }
                
                #search input[type="text"] {
                     margin-left: 20px!important; 
                    }
                
                #search img {
float: right;
height: 44%;
margin-right: 25px;
margin-top: 12px;
}
                
            }
                @media (max-width: 600px) {
                #search {
                 width: 83%!important;
                    left: 3%!important;   
                }
                    
                      form#search {
                         width: 100%!important;
                    left: 0%!important;
                        }
                
                    #search input[type="text"] {
                     font-size: 14px;   
                    }
                    
                    li {
                     font-size: 12px;   
                    
                    }
                        
            }
            
            
            .help {
    position: absolute;
    right: 15px;
    bottom: 15px;
}

p {
    font-size: 21px;
    color: white;
    font-family: "fira-sans";
    margin-bottom: 0px;
    padding-left: 15px;
    padding-right: 15px;
}
            
            
            
            .tutorial {
    position: absolute;
    top: 0px;
    left: 0px;
    width: 100%;
    height: 100%;
    background-color: rgba(0,0,0,0.4);
    display: none;
}

.horizontalTutorial {
    background-color: rgba(137,192,232,.62);
    position: absolute;
    height: 19px;
    padding-top: 5px;
    padding-left: 15px;
    padding-right: 15px;
    color: white;
    font-family: "fira-sans";
    font-weight: 200;
    font-size: 14px;
}

div#toggleHelp {
    top: 34px;
    left: 79.5%;
    border-radius: 0px 10px 10px 0px;
    padding-left: 27px;
}

div#addHelp {
    top: 36.5px;
    right: 31%;
    padding-right: 34px;
    border-radius: 10px 0px 0px 10px;
}

div#visibilityHelp {
top: 96px;
left: 9.25%;
right: calc(68.25% + 25px);
padding-right: 16px;
border-radius: 10px 0px 0px 10px;
}

div#exitHelp {}

div#exitHelp {
    bottom: 13px; right: 52px; border-radius: 10px 0px 0px 10px; padding-right: 26px;
}

div#removeHelp {}

div#removeHelp {
top: 142px;
left: 19.25%;
padding-right: 19px;
border-radius: 10px 0px 0px 10px;
}     
          
    li img {
height: 15px!important;
margin-top: 0px!important;
position: absolute;
transform-origin: center;
transform: rotate(45deg);
}

span.listItem {
    margin-left: 35px;
}

.visibleSwitch {
background-color: black;
width: 16px;
height: 16px;
float: left;
margin-left: 0px;
border-radius: 16px;
margin-right: 20px;
}
            
           div#progressBar {
    height: 100%;
    background-color: rgba(0,0,0,.25);
    width: 0%;
    
    z-index: -7;
    border-radius: 25px;
} 
            
            
            
            
            .error {
    position: absolute;
    width: 50%;
    height: 25%;
    background-color: rgba(0,0,0,.4);
    top: 30%;
    left: 25%;
    border-radius: 25px;
               
}

.error img {
    width: 20px;
    height: 20px;
    transform-origin: center;
    transform: rotate(45deg);
    position: absolute;
    right: 22px;
    top: 15px;
}

.error .content {
    position: absolute;
    width: 69%;
    height: 53%;
    top: 30%;
    left: 10%;
    font-family: "fira-sans";
    font-size: 17px;
    line-height: 24px;
}
            
            
        @media (max-width: 900px) {     
            
            div#toggleHelp {
    border-radius: 0px 0px 10px 10px;
    width: 50px;
    height: 37px;
    top: 46px;
    right: 4%;
    left: initial;
}

div#addHelp {
    top: 17px;
    right: 23%;
}

div#removeHelp {
top: 126px;
left: 27%;
right: initial;
border-radius: 0px 10px 10px 0px;
}
            
  div#visibilityHelp {
top: 75px;
left: 22%;
right: initial;
border-radius: 0px 10px 10px 0px;
}
            
        }
            
         @media (max-width: 600px) {    
            
            
            div#addHelp {
    right: 28%;
}

div#toggleHelp {
    right: 0%;
}

div#visibilityHelp {
left: 24%;
}

div#removeHelp {
left: 32%;
}
         }
            
		</style>
		<!--[if lt IE 9]>
			<script type="text/javascript">alert("Your browser does not support the canvas tag.");</script>
		<![endif]-->
		<script src="http://cdn.jsdelivr.net/jquery/2.1.1/jquery.min.js"></script>
		<script src="/processing.js" type="text/javascript"></script>
		<script type="text/javascript">
// convenience function to get the id attribute of generated sketch html element
function getProcessingSketchId () { return 'gridTest2'; }
</script>

	</head>
	<body>
	
		
				
		<div id="content">
			
				<canvas id="processingSketch" data-processing-sources="/gridTest2.pde" 
						width="2048" height="1024">
					<p>Your browser does not support the canvas tag.</p>
					<!-- Note: you can put any alternative content here. -->
				</canvas>
				<noscript>
					<p>JavaScript is required to view the contents of this page.</p>
				</noscript>
	    	
	    	
	    	<div id="realContainer">
	    	    <div class="error">
	    	        <img src="add.svg"></img>
	    	        <div class="content"></div>
	    	        
	    	    </div>
	    	    <div id="search">
    	        <div id="progressBar"></div>
	    	        <form action="none" id="search">
	    	            <input type="text" placeholder="Enter website url to see its route..."></input>
	    	            <img src="search.svg" alt="Search">
	    	        </form>
	    	        <div class="toggler"><img src="triangle.svg" alt="Expand List"></div>
	    	        
	    	        <div id="list">
	    	            <ul>
	    	               
	    	            </ul>
	    	            
	    	            
	    	        </div>
	    	    </div>
	    	    
	    	    <div class="help">
	    	        <p>?</p>   	        
	    	        
	    	    </div>
	    	    
	    	    <div class="tutorial">
    	        
	    	        <div class="horizontalTutorial" id="toggleHelp">Toggle the list</div>
	    	        <div class="horizontalTutorial" id="addHelp">Add a site to the list</div>
	    	        <div class="horizontalTutorial" id="removeHelp">Remove the site</div>
	    	        <div class="horizontalTutorial" id="visibilityHelp">Toggle the visibility</div>
	    	        <div class="horizontalTutorial" id="exitHelp">Click anywhere to go to the map</div>
	    	        <div class="horizontalTutorial" id="moreHelp">Display more information</div>
	    	        
	    	        
	    	    </div>
	    	    
	    	</div>
	    	
		</div>
		
		<script>
            
            var scaleX = window.innerWidth/2048;
            var scaleY = window.innerHeight/1024;
            
            var whichScale;
            if (window.innerWidth> window.innerHeight *2) {
                whichScale = scaleX;
                
            } else {
             whichScale = scaleY;   
            }
            
            whichScale = lerp(whichScale,1,.2);
            
            
            
            
            
            var drag, search, tut;
            
            $(window).load(function() {
            $("#processingSketch").css("transform","scale(" + whichScale + "," + whichScale + ") translateX(-" + (((2048*whichScale) - window.innerWidth)/2) + "px)");
                
                drag = new setUpDragging(((2048 - window.innerWidth)/2), whichScale);
                search = new searchMenu();
                
                $(window).resize(function() {
                   resize();
                   $('#content').hide().show(0);
                });
                
                 requestAnimationFrame(search.loader);
                
                
                $(".error").hide();
                $(".error img").click(function() {
                    $(".error .content").html("");
                   $(".error").hide(); 
                    
                });
                
                tut = new tutorial();
                
            });
            //var proc = Processing.getElementById('processingSketch');
        
            
            
            function resize() {
                 var scaleX = window.innerWidth/2048;
            var scaleY = window.innerHeight/1024;
            
            var whichScale;
            if (window.innerWidth> window.innerHeight *2) {
                whichScale = scaleX;
                
            } else {
             whichScale = scaleY;   
            }
            
            whichScale = lerp(whichScale,1,.2);
               drag.scale = whichScale; 
                drag.resize();
                drag.moveIt();
                
            }
            
            
            function setUpDragging(startingX, startingScale) {
                
                this.xPos = 0;
                this.yPos = 0;
                this.oldX = 0;
                this.oldY = 0;
                this.xOff = -1 * startingX;
                console.log(this.xOff);
                this.yOff = 0;
                
                this.scale = startingScale;
                
                this.size = {};
                this.size.w = 2048 * this.scale;
                this.size.h = 1024 * this.scale;
                
                
                this.bounds = {};
                this.bounds.left = window.innerWidth - this.size.w;
                this.bounds.top = window.innerHeight - this.size.h;
                this.bounds.bottom = 0;
                this.bounds.right = 0;
                
                
                
                this.resize = function() {
                   this.size.w = 2048 * this.scale;
                this.size.h = 1024 * this.scale; 
                    
                   this.bounds.left = window.innerWidth - this.size.w;
                this.bounds.top = window.innerHeight - this.size.h;
                this.bounds.bottom = 0;
                this.bounds.right = 0;
                 
                }
                
                
                this.clicked = false;
                
                var el = $("#realContainer")[0];
                
                
                this.start = function(e) {
                    // console.log(e);   
                    if (e.targetTouches) {
                     e = e.targetTouches[0];   
                    }
                    
                    drag.clicked = true;
                    drag.xPos = e.pageX;
                    drag.yPos = e.pageY;
                };
                
                this.move = function(e) {
                    
                    
                    var toContinue = false;
                    
                    if (e.toElement) {
                     if  (e.toElement.id=="realContainer") {
                      toContinue=true;   
                     }
                    } else {
                     if (e.srcElement.id=="realContainer") {
                         toContinue=true; 
                     }
                    }
                    
                   if (drag.clicked && toContinue) {
                       
                        if (e.targetTouches) {
                     e = e.targetTouches[0];   
                    }
                       
                    //console.log(e);   
                    drag.oldX = drag.xPos;
                    drag.oldY = drag.yPos;
                    drag.xPos = e.pageX;
                    drag.yPos = e.pageY;
                       
                       var moveItX = drag.xPos - drag.oldX;
                       var moveItY = drag.yPos - drag.oldY;
                       console.log(moveItX + " " + moveItY);
                       console.log(drag.xOff);
                       console.log(drag);
                       drag.xOff += moveItX;
                       drag.yOff+= moveItY;
                       
                      
                       
                       console.log(drag.xOff);
                       console.log("translate(" + drag.xOff + "px, " + drag.yOff + "px) scale(" + drag.scale + "," + drag.scale + ")");
                     //   $("#processingSketch").css("transform","scale(" + drag.scale + "," + drag.scale + ") translate(" + drag.xOff + "px, " + drag.yOff + "px)");
                    drag.moveIt();
                   }
                    
                };
                
                this.end = function(e) {
                    drag.clicked=false;
                    
                }
                
                
                this.moveIt = function() {
                        
                         if (this.xOff>0) {
                        this.xOff = 0;   
                       } else if(this.xOff<this.bounds.left){
                        this.xOff=this.bounds.left;   
                       }
                       
                       if (this.yOff>0) {
                        this.yOff = 0;   
                       } else if(this.yOff<this.bounds.top){
                        this.yOff=this.bounds.top;   
                       }
                    
                    
                      $("#processingSketch").css("transform","scale(" + this.scale + "," + this.scale + ") translate(" + this.xOff + "px, " + this.yOff + "px)");
                    
                }
                
                
                el.addEventListener("touchstart", this.start, false);
                
                el.addEventListener("touchmove", this.move, false);
                
                el.addEventListener("touchend", this.end, false);
                
                 el.addEventListener("mousedown", this.start, false);
                
                el.addEventListener("mousemove", this.move, false);
                
                el.addEventListener("mouseup", this.end, false);
                
                
            }
            
            
            
            
            function tutorial() {
                
             this.visible = false;
                
                $(".help").click(function() {
                   
                   
                        this.visisble = true;
                     $(".tutorial").css("display", "block");   
                  if (search.open==false) {
                      search.toggleIt()
                      
                  }
                    
                    
                });
                
                $(".tutorial").click(function() {
                       this.visisble = false;
                     $(".tutorial").removeAttr("style");
                    
                    if (search.open) {
                      search.toggleIt()
                      
                  }
                    
                });
                
                
                
            }
            
            
            function searchMenu() {
                
             this.toggler = $(".toggler");
             this.search = $("#search img");
             this.progressBar = $("#progressBar");
                
                this.progress = 0;
                this.loading = false;
                
                this.open = false;
                
                
                
                this.routes = [];
                
                
               
                
                
                this.toggleIt = function() {
                   if (this.open==false) {
                     this.open = true;   
                        $("#list").height("150px");
                    } else {
                        this.open = false;
                        
                        $("#list").removeAttr("style");
                    }  
                    
                }
                
                
                 this.toggler.click(function() {
                   search.toggleIt();
                    
                });
                
             
                this.suspendSubmission = false;
                
                
                this.loader = function() {
                   
                 if (search.loading) {
                  search.progress+=.03;
                     search.progressBar.css("width",search.progress + "%");
                     
                 }
                    
                    requestAnimationFrame(search.loader);
                }
                
                
               
                
                
                
                this.submission = function() {
                    if (this.suspendSubmission==false) {
                    var input = $("form#search  input").val();
                    console.log(input);
                    
                    if (input=="") {
                     return false;   
                    }
                        this.loading = true;
                    
                    this.suspendSubmission=true;
                    
                    
                        this.error = function() {
                            search.suspendSubmission=false;
                                search.loading = false;
                                search.progress=0;
                                 search.progressBar.removeAttr("style");
                                
                                $(".error .content").html("Sorry, we couldn't get the route to that site, try again. Or maybe try a different site.");
                                $(".error").show();
                            
                        }
                        
                    input = input.trim();
                        
                        $.ajax({
                            type: "GET",
                            url: "http://idtraceroute.herokuapp.com/route3/" + input + "/1300/33434",
                            success: function(e) {
                                console.log(e);
                                
                                if (e=="error") {
                                    
                                    search.error();
                                    
                                    
                                } else {
                                var myArray = /\d+\:+\s+(\d+\.)+\d+\s+\d+\.+\d+\w+/g.exec(e);
                                    
                                    console.log(myArray);
                                    
                                    var num = search.routes.length;
                                    search.routes[num] = [];
                                    search.routes[num].route = e;
                                    
                                    
                                $("form#search  input").val("");
                                addLi(input, num);
                                search.suspendSubmission=false;
                                search.loading = false;
                                search.progress=0;
                                search.progressBar.css("transition","all .5s");
                                search.progressBar.css("width","100%");
                                
                                setTimeout(function() {
                                
                                    search.progressBar.removeAttr("style");
                                    
                                },1400);
                                    
                                }
                                
                            },
                            error: function(e) {
                             console.log(e);  
                            search.error();
                                
                                
                            },
                            timeout: 20000
                            }) 
                    
                    
                    
                }
                }
                
                $("form#search").submit(function(e) {
                    e.preventDefault();
                    console.log("haha");
                    search.submission();
                    
                    
                }); 
                
                this.search.click(function() {
                   $("form#search").submit(); 
                    
                });
                
                
            }
        
            
            
            
        function addLi(site, num) {
            
            var li = document.createElement('li');
            
            var img = document.createElement('img');
            img.src="add.svg";
            
            var swi = document.createElement('div');
            swi.className = "visibleSwitch";
            
            var span = document.createElement('span');
            span.className = "listItem";
            span.innerHTML = site;
            
            li.appendChild(img);
            li.appendChild(swi);
            li.appendChild(span);
            
            var list = document.getElementById("list").childNodes[1];
            
            search.routes[num].ele = li;
            
            list.appendChild(li);
            
            // <li><img src="add.svg"></img><div class="visibleSwitch"></div><span class="listItem">www.facebook.com</span></li>
            
            
        }
            
            
            
        function dist(x1, y1, x2, y2) {

            var dx = Math.abs(x1 - x2);
            var dy = Math.abs(y1 - y2);

            var d = Math.sqrt(Math.pow(dx, 2) + Math.pow(dy, 2));

            return d;

        }
      
       
        
        
         function radians(degrees) {
            return degrees * Math.PI / 180;
        };

        function degrees(radians) {
            return radians * 180 / Math.PI;
        };
    
        
        
        function lerp(a, b, t) {
            var x = a + t * (b - a);
            return x;
        }
            
        </script>
		
		
	</body>
</html>
